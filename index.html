<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player M3U8 Smart</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>üé¨ Player M3U8 - Tizen TV</h1>
        
        <div class="button-container">
            <button class="btn btn-show" id="showBtn">üì∫ Canais Fixos</button>
            <button class="btn btn-m3u8" id="m3u8Btn">üé¨ M3U8 Player</button>
            <button class="btn btn-hide" id="hideBtn" disabled>‚ùå Fechar</button>
        </div>

        <div class="channel-selection" id="channelSelection">
            <h2>üì∫ Escolha um Canal</h2>
            <div class="channel-grid" id="channelGrid"></div>
        </div>

        <div class="player-container" id="playerContainer">
            <div class="video-wrapper">
                <iframe id="playerFrame" class="tizen-video" frameborder="0" allowfullscreen></iframe>
            </div>
            <div class="controls">
                <button class="control-btn" onclick="hidePlayer()">Voltar</button>
            </div>
        </div>

        <div class="player-container" id="m3u8Container">
            <div class="input-section">
                <h3>üîê Playlist Oculta</h3>
                <div class="input-group">
                    <label for="codeInput">C√≥digo de Acesso:</label>
                    <input type="text" id="codeInput" placeholder="Digite o c√≥digo da playlist (tvmista, teste, educativo)">
                </div>
                <button class="btn btn-m3u8" id="loadHiddenBtn" onclick="loadHiddenPlaylist()">üöÄ Carregar Playlist</button>
            </div>

            <div class="input-section">
                <h3>üåê Carregar Playlist Manualmente</h3>
                <div class="input-group">
                    <label for="urlInput">URL da Playlist:</label>
                    <input type="url" id="urlInput" placeholder="https://exemplo.com/playlist.m3u8">
                </div>
                <button class="btn btn-m3u8" onclick="loadPlaylist()">Carregar URL</button>
            </div>

            <div class="video-wrapper">
                <video id="tizenVideo" class="tizen-video" controls playsinline webkit-playsinline></video>
            </div>

            <div class="controls">
                <button class="control-btn" onclick="previousChannel()">‚èÆÔ∏è Anterior</button>
                <button class="control-btn" onclick="nextChannel()">‚è≠Ô∏è Pr√≥ximo</button>
                <button class="control-btn" onclick="reloadChannel()">üîÑ Recarregar</button>
                <button class="control-btn" onclick="togglePlayPause()">‚èØÔ∏è Play/Pause</button>
            </div>

            <div class="playlist-info">
                <h3>üìã Lista de Canais (<span id="channelCount">0</span>)</h3>
                <div class="playlist-container" id="m3u8Playlist"></div>
            </div>
        </div>

        <div class="status" id="status"></div>
    </div>

    <div class="button-container" style="margin-top: 30px;">
        <button class="btn btn-external" onclick="window.open('https://nossoplayeronlinehd.blog/', '_blank')">üåê Nosso Player Online</button>
        <button class="btn btn-external" onclick="window.open('https://embedcanaistv.com/', '_blank')">üì∫ Embed Canais TV</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        // Canais fixos otimizados para Tizen
        const channels = [
            { name: 'Warner', url: 'https://embedcanaistv.com/warner/', icon: 'üé¨' },
            { name: 'ESPN', url: 'https://embedcanaistv.com/espn/', icon: '‚öΩ' },
            { name: 'ESPN2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn2', icon: '‚öΩ' },
            { name: 'ESPN3', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn3', icon: '‚öΩ' },
            { name: 'ESPN4', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn4', icon: '‚öΩ' },
            { name: 'ESPN5', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn5', icon: '‚öΩ' },
            { name: 'ESPN6', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn6', icon: '‚öΩ' },
            { name: 'SportTV1', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=sportv1', icon: '‚öΩ' },
            { name: 'SportTV2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=sportv2', icon: '‚öΩ' },
            { name: 'SportTV3', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=sportv3', icon: '‚öΩ' },
            { name: 'Premiere', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiereclubes', icon: '‚öΩ' },
            { name: 'Premiere2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere2', icon: '‚öΩ' },
            { name: 'Premiere3', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere3', icon: '‚öΩ' },
            { name: 'Premiere4', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere4', icon: '‚öΩ' },
            { name: 'Premiere5', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere5', icon: '‚öΩ' },
            { name: 'Premiere6', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere6', icon: '‚öΩ' },
            { name: 'TNT', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=tnt', icon: 'üì∫' },
            { name: 'TNTseries', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=tntseries', icon: 'üì∫' },
            { name: 'HBO', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=hbo', icon: 'üì∫' },
            { name: 'HBO2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=hbo2', icon: 'üì∫' },
            { name: 'Universal', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=universal', icon: 'üì∫' },
            { name: 'Space', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=space', icon: 'üì∫' },
            { name: 'Telecine Action', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=telecineaction', icon: 'üì∫' },
            { name: 'Megapix', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=megapix', icon: 'üì∫' },
            { name: 'UFC', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=ufcfightpass', icon: 'üì∫' },
        ];

        // Sistema de playlists ocultas com m√∫ltiplas estrat√©gias de carregamento
        const playlistDatabase = {
            tvmista: {
                name: "TV Mista",
                content: `#EXTINF:-1,BR: Friends
http://24hrs.homelinux.com:8080/24H-friends/video.m3u8
#EXTINF:-1,4K: TINY4K
http://lunar.pm:8080/ALVIN/9gJbtWskzsJS/122876
#EXTINF:-1,BR: Eu a Patroa e as Crian√ßas 24h
http://24hrs.homelinux.com:8080/24H-euapatroaeascriancas7/playlist.m3u8
#EXTINF:-1,BR: 2 Homens e Meio 24h
http://24hrs.homelinux.com:8080/24H-2HomensEmeio/playlist.m3u8
#EXTINF:-1,BR: Todo Mundo Odeia O Cris 24h
http://24hrs.homelinux.com:8080/24H-todomundoodeiaocris/video.m3u8
#EXTINF:-1,BR: Um Maluco no Peda√ßo 24h
http://24hrs.homelinux.com:8080/24H-ummaluconopedaco/playlist.m3u8`,
                fallbackUrls: [
                    "https://api.allorigins.win/raw?url=https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/tvmisto.m3u8",
                    "https://cors-anywhere.herokuapp.com/https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/tvmisto.m3u8"
                ]
            },
            teste: {
                name: "Playlist Teste",
                content: `#EXTM3U
#EXTINF:-1,Teste Stream 1
https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8
#EXTINF:-1,Teste Stream 2
https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8
#EXTINF:-1,Big Buck Bunny
https://test-streams.mux.dev/dai-discontinuity-deltatre/manifest.m3u8
#EXTINF:-1,Sample Stream 4K
https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4
#EXTINF:-1,Arte Concerto
https://arteconcert-lh.akamaihd.net/i/arte_concert@356450/master.m3u8`,
                fallbackUrls: [
                    "https://api.allorigins.win/raw?url=https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/teste.m3u8"
                ]
            },
            educativo: {
                name: "Canais Educativos",
                content: `#EXTINF:-1,BR: Friends
http://24hrs.homelinux.com:8080/24H-friends/video.m3u8
#EXTINF:-1,BR: Eu a Patroa e as Crian√ßas 24h
http://24hrs.homelinux.com:8080/24H-euapatroaeascriancas7/playlist.m3u8
#EXTINF:-1,BR: 2 Homens e Meio 24h
http://24hrs.homelinux.com:8080/24H-2HomensEmeio/playlist.m3u8
#EXTINF:-1,BR: Todo Mundo Odeia O Cris 24h
http://24hrs.homelinux.com:8080/24H-todomundoodeiaocris/video.m3u8
#EXTINF:-1,BR: Um Maluco no Peda√ßo 24h
http://24hrs.homelinux.com:8080/24H-ummaluconopedaco/playlist.m3u8`,
                fallbackUrls: [
                    "https://api.allorigins.win/raw?url=https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/educativo.m3u8"
                ]
            }
        };

        // Vari√°veis globais
        let m3u8Channels = [];
        let currentM3U8Channel = -1;
        let hls = null;
        let video = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            video = document.getElementById('tizenVideo');
            
            // Configurar bot√µes
            document.getElementById('showBtn').addEventListener('click', showChannelSelection);
            document.getElementById('m3u8Btn').addEventListener('click', showM3U8Player);
            document.getElementById('hideBtn').addEventListener('click', hidePlayer);
            
            // Configurar eventos de teclado para Smart TV
            setupTVControls();
            setupEventListeners();
            
            // Verificar se √© uma Tizen TV
            if (isTizenTV()) {
                showStatus('üñ•Ô∏è Modo Tizen ativado - Player otimizado', 'visible');
            }
        });

        function setupEventListeners() {
            // Enter no input para carregar playlist oculta
            document.getElementById('codeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadHiddenPlaylist();
                }
            });

            // Enter no input para carregar URL
            document.getElementById('urlInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadPlaylist();
                }
            });

            // Controles de teclado para Smart TV (espec√≠ficos para M3U8)
            document.addEventListener('keydown', function(e) {
                if (document.getElementById('m3u8Container').classList.contains('show')) {
                    switch(e.keyCode) {
                        case 37: // Seta esquerda
                            previousChannel();
                            break;
                        case 39: // Seta direita
                            nextChannel();
                            break;
                        case 32: // Espa√ßo
                            e.preventDefault();
                            togglePlayPause();
                            break;
                        case 13: // Enter
                            if (document.activeElement.id === 'codeInput' || document.activeElement.id === 'urlInput') return;
                            togglePlayPause();
                            break;
                    }
                }
            });
        }

        // Fun√ß√µes principais
        function showChannelSelection() {
            hideAllPlayers();
            document.getElementById('channelSelection').classList.add('show');
            updateButtons('channel');
            showStatus('üì∫ Selecione um canal para assistir', 'visible');
            createChannelButtons();
        }

        function showM3U8Player() {
            hideAllPlayers();
            document.getElementById('m3u8Container').classList.add('show');
            updateButtons('m3u8');
            showStatus('üé¨ Carregue uma playlist M3U8 ou digite um c√≥digo de acesso', 'visible');
        }

        function hidePlayer() {
            hideAllPlayers();
            if (hls) {
                hls.destroy();
                hls = null;
            }
            updateButtons('none');
            showStatus('üî¥ Selecione uma op√ß√£o para come√ßar', 'visible');
        }

        function hideAllPlayers() {
            document.getElementById('channelSelection').classList.remove('show');
            document.getElementById('playerContainer').classList.remove('show');
            document.getElementById('m3u8Container').classList.remove('show');
            
            // Limpar players
            document.getElementById('playerFrame').src = '';
            if (video) {
                video.src = '';
                video.load();
            }
        }

        function updateButtons(active) {
            document.getElementById('showBtn').disabled = active === 'channel';
            document.getElementById('m3u8Btn').disabled = active === 'm3u8';
            document.getElementById('hideBtn').disabled = active === 'none';
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Canais Fixos
        function createChannelButtons() {
            const grid = document.getElementById('channelGrid');
            grid.innerHTML = '';
            
            channels.forEach((channel, index) => {
                const btn = document.createElement('button');
                btn.className = 'channel-btn';
                btn.innerHTML = `${channel.icon} ${channel.name}`;
                btn.onclick = () => playFixedChannel(channel, index);
                grid.appendChild(btn);
            });
        }

        function playFixedChannel(channel, index) {
            // Limpar sele√ß√£o anterior
            document.querySelectorAll('.channel-btn').forEach(btn => btn.classList.remove('active'));
            
            // Marcar como ativo
            document.querySelectorAll('.channel-btn')[index].classList.add('active');
            
            // Configurar iframe
            const iframe = document.getElementById('playerFrame');
            iframe.src = channel.url.startsWith('//') ? 'https:' + channel.url : channel.url;
            
            // Mostrar player
            document.getElementById('playerContainer').classList.add('show');
            showStatus(`‚ñ∂Ô∏è Assistindo: ${channel.name}`, 'visible');
        }

        // Sistema de Playlist Oculta Integrado
        async function loadHiddenPlaylist() {
            const code = document.getElementById('codeInput').value.trim().toLowerCase();
            const btn = document.getElementById('loadHiddenBtn');
            
            if (!code) {
                showStatus('‚ùå Digite um c√≥digo de acesso v√°lido', 'error');
                return;
            }

            if (!playlistDatabase[code]) {
                showStatus('‚ùå C√≥digo inv√°lido. C√≥digos dispon√≠veis: tvmista, teste, educativo', 'error');
                return;
            }

            // Atualizar bot√£o
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Carregando...';

            try {
                const playlist = playlistDatabase[code];
                showStatus(`üîÑ Carregando ${playlist.name}...`, 'visible');
                
                // Primeiro tentar o conte√∫do embutido
                if (playlist.content) {
                    console.log('Usando playlist embutida');
                    parseM3UContent(playlist.content);
                    showStatus(`‚úÖ ${playlist.name} carregada com sucesso! ${m3u8Channels.length} canais encontrados`, 'visible');
                    if (m3u8Channels.length > 0) {
                        playM3U8Channel(0);
                    }
                } else if (playlist.fallbackUrls && playlist.fallbackUrls.length > 0) {
                    // Tentar URLs de fallback se dispon√≠veis
                    const success = await loadPlaylistFromUrls(playlist.fallbackUrls);
                    
                    if (success) {
                        showStatus(`‚úÖ ${playlist.name} carregada com sucesso! ${m3u8Channels.length} canais encontrados`, 'visible');
                        if (m3u8Channels.length > 0) {
                            playM3U8Channel(0);
                        }
                    } else {
                        showStatus('‚ùå N√£o foi poss√≠vel carregar a playlist. Usando conte√∫do de backup.', 'error');
                    }
                } else {
                    showStatus('‚ùå Playlist n√£o dispon√≠vel no momento.', 'error');
                }
            } catch (error) {
                console.error('Erro ao carregar playlist:', error);
                showStatus('‚ùå Erro interno. Usando playlist de backup.', 'error');
                
                // Usar conte√∫do embutido como fallback final
                const playlist = playlistDatabase[code];
                if (playlist.content) {
                    parseM3UContent(playlist.content);
                    if (m3u8Channels.length > 0) {
                        playM3U8Channel(0);
                        showStatus(`‚úÖ Playlist de backup carregada - ${m3u8Channels.length} canais`, 'visible');
                    }
                }
            } finally {
                btn.disabled = false;
                btn.textContent = 'üöÄ Carregar Playlist';
            }
        }

        // Carregamento de URLs alternativas
        async function loadPlaylistFromUrls(urls) {
            for (const url of urls) {
                try {
                    console.log(`Tentando carregar de: ${url}`);
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/plain, application/vnd.apple.mpegurl, application/x-mpegURL',
                        },
                        mode: 'cors'
                    });
                    
                    if (response.ok) {
                        const content = await response.text();
                        if (content && content.includes('#EXTM3U')) {
                            console.log('Playlist carregada com sucesso de:', url);
                            parseM3UContent(content);
                            return true;
                        }
                    }
                } catch (error) {
                    console.log(`Falha ao carregar de ${url}:`, error.message);
                }
            }
            return false;
        }

        function loadPlaylist() {
            const url = document.getElementById('urlInput').value.trim();
            
            if (!url) {
                showStatus('‚ùå Digite uma URL v√°lida', 'error');
                return;
            }
            
            loadPlaylistFromUrl(url);
        }

        function loadPlaylistFromUrl(url) {
            showStatus('üîÑ Carregando playlist...', 'visible');
            
            // Adiciona timestamp para evitar cache
            const cacheBusterUrl = url + (url.includes('?') ? '&' : '?') + '_=' + Date.now();
            
            return fetch(cacheBusterUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Erro na requisi√ß√£o: ' + response.status);
                    return response.text();
                })
                .then(data => {
                    if (!data.includes('#EXTM3U')) {
                        throw new Error('Formato M3U inv√°lido');
                    }
                    parseM3UContent(data);
                    showStatus(`‚úÖ Playlist carregada - ${m3u8Channels.length} canais`, 'visible');
                    if (m3u8Channels.length > 0) {
                        playM3U8Channel(0);
                    }
                    return true;
                })
                .catch(error => {
                    // Tentar com proxy CORS se falhar
                    if (!url.includes('cors-anywhere') && !url.includes('allorigins')) {
                        const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
                        return loadPlaylistFromUrl(proxyUrl);
                    }
                    showStatus(`‚ùå Erro ao carregar: ${error.message}`, 'error');
                    throw error;
                });
        }

        // Parser M3U otimizado
        function parseM3UContent(content) {
            m3u8Channels = [];
            const lines = content.split('\n').map(line => line.trim()).filter(line => line);
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                if (line.startsWith('#EXTINF:')) {
                    // Extrair nome do canal
                    const nameMatch = line.match(/,(.+)$/);
                    const name = nameMatch ? nameMatch[1].trim() : `Canal ${m3u8Channels.length + 1}`;
                    
                    // Pr√≥xima linha deve ser a URL
                    const nextLine = lines[i + 1];
                    if (nextLine && !nextLine.startsWith('#') && (nextLine.startsWith('http') || nextLine.startsWith('//'))) {
                        const url = nextLine.startsWith('//') ? 'https:' + nextLine : nextLine;
                        
                        m3u8Channels.push({
                            title: name,
                            url: url
                        });
                    }
                }
            }
            
            updatePlaylistDisplay();
        }

        function updatePlaylistDisplay() {
            const playlist = document.getElementById('m3u8Playlist');
            playlist.innerHTML = '';
            
            m3u8Channels.forEach((channel, index) => {
                const item = document.createElement('div');
                item.className = 'm3u8-channel';
                item.textContent = `${index + 1}. ${channel.title}`;
                item.onclick = () => playM3U8Channel(index);
                playlist.appendChild(item);
            });
            
            document.getElementById('channelCount').textContent = m3u8Channels.length;
        }

        // Reprodu√ß√£o otimizada com sistema avan√ßado do index2
        function playM3U8Channel(index) {
            if (index < 0 || index >= m3u8Channels.length) return;
            
            currentM3U8Channel = index;
            const channel = m3u8Channels[index];
            
            // Atualizar sele√ß√£o visual
            document.querySelectorAll('.m3u8-channel').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
            
            showStatus(`üîÑ Carregando: ${channel.title}`, 'visible');
            
            // Limpar player anterior
            if (hls) {
                hls.destroy();
                hls = null;
            }
            
            video.src = '';
            video.load();
            
            // Reproduzir baseado no tipo de stream
            if (channel.url.includes('.m3u8')) {
                playHLSStream(channel);
            } else {
                playDirectStream(channel);
            }
        }

        // Reprodu√ß√£o HLS com suporte completo
        function playHLSStream(channel) {
            const url = channel.url;
            
            // Verificar se o navegador suporta HLS nativamente
            if (video.canPlayType('application/vnd.apple.mpegurl')) {
                console.log('üçé Usando HLS nativo do navegador');
                playNativeHLS(channel);
            } 
            // Usar HLS.js para outros navegadores
            else if (Hls.isSupported()) {
                console.log('üì° Usando HLS.js para reprodu√ß√£o');
                playWithHlsJS(channel);
            }
            // Fallback para tentativa direta
            else {
                console.log('üîÑ Tentativa de reprodu√ß√£o direta');
                playDirectStream(channel);
            }
        }

        // HLS Nativo (Safari, iOS, algumas Smart TVs)
        function playNativeHLS(channel) {
            video.src = channel.url;
            
            const playPromise = video.play();
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        showStatus(`‚ñ∂Ô∏è Reproduzindo: ${channel.title}`, 'visible');
                    })
                    .catch(error => {
                        console.error('Erro na reprodu√ß√£o nativa:', error);
                        showStatus(`‚ùå Erro ao reproduzir: ${channel.title}. Tentando m√©todo alternativo...`, 'error');
                        
                        // Tentar com HLS.js como fallback
                        if (Hls.isSupported()) {
                            setTimeout(() => playWithHlsJS(channel), 1000);
                        }
                    });
            }
        }

        // HLS.js (Chrome, Firefox, Edge)
        function playWithHlsJS(channel) {
            hls = new Hls({
                enableWorker: false,
                lowLatencyMode: false,
                backBufferLength: 30,
                maxBufferLength: 60,
                maxMaxBufferLength: 120,
                startLevel: -1,
                debug: false,
                xhrSetup: function(xhr, url) {
                    xhr.withCredentials = false;
                }
            });
            
            hls.loadSource(channel.url);
            hls.attachMedia(video);
            
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                console.log('üìã Manifest HLS carregado');
                
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            showStatus(`‚ñ∂Ô∏è Reproduzindo: ${channel.title}`, 'visible');
                        })
                        .catch(error => {
                            console.error('Erro na reprodu√ß√£o HLS.js:', error);
                            showStatus(`‚ö†Ô∏è ${channel.title} carregado. Clique em Play para iniciar.`, 'visible');
                        });
                }
            });
            
            hls.on(Hls.Events.ERROR, function(event, data) {
                console.error('‚ùå Erro HLS.js:', data);
                
                if (data.fatal) {
                    switch(data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            showStatus(`‚ùå Erro de rede: ${channel.title}. Tentando recarregar...`, 'error');
                            setTimeout(() => {
                                hls.startLoad();
                            }, 2000);
                            break;
                            
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            showStatus(`‚ùå Erro de m√≠dia: ${channel.title}. Tentando recuperar...`, 'error');
                            hls.recoverMediaError();
                            break;
                            
                        default:
                            showStatus(`‚ùå Erro fatal no player: ${channel.title}`, 'error');
                            hls.destroy();
                            hls = null;
                            break;
                    }
                }
            });
        }

        // Reprodu√ß√£o direta (MP4, WebM, etc.)
        function playDirectStream(channel) {
            console.log('üé¨ Reprodu√ß√£o direta do stream');
            
            video.src = channel.url;
            video.crossOrigin = 'anonymous';
            
            video.addEventListener('loadeddata', function() {
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            showStatus(`‚ñ∂Ô∏è Reproduzindo: ${channel.title}`, 'visible');
                        })
                        .catch(error => {
                            console.error('Erro na reprodu√ß√£o direta:', error);
                            showStatus(`‚ö†Ô∏è ${channel.title} carregado. Clique em Play para iniciar.`, 'visible');
                        });
                }
            }, { once: true });
            
            video.addEventListener('error', function(event) {
                console.error('‚ùå Erro no v√≠deo:', event);
                showStatus(`‚ùå N√£o foi poss√≠vel reproduzir: ${channel.title}`, 'error');
            }, { once: true });
        }

        // Controles
        function previousChannel() {
            if (m3u8Channels.length === 0) return;
            const prevIndex = currentM3U8Channel <= 0 ? m3u8Channels.length - 1 : currentM3U8Channel - 1;
            playM3U8Channel(prevIndex);
        }

        function nextChannel() {
            if (m3u8Channels.length === 0) return;
            const nextIndex = currentM3U8Channel >= m3u8Channels.length - 1 ? 0 : currentM3U8Channel + 1;
            playM3U8Channel(nextIndex);
        }

        function reloadChannel() {
            if (currentM3U8Channel >= 0) {
                showStatus('üîÑ Recarregando canal...', 'visible');
                
                // Limpar player atual
                if (hls) {
                    hls.destroy();
                    hls = null;
                }
                
                video.src = '';
                video.load();
                
                // Aguardar um pouco antes de recarregar
                setTimeout(() => {
                    playM3U8Channel(currentM3U8Channel);
                }, 500);
            }
        }

        function togglePlayPause() {
            if (!video.src) return;
            
            if (video.paused) {
                video.play().catch(console.error);
            } else {
                video.pause();
            }
        }

        // Utilit√°rios
        function isTizenTV() {
            return navigator.userAgent.includes('Tizen') || 
                   navigator.userAgent.includes('SMART-TV') ||
                   typeof tizen !== 'undefined';
        }

        function setupTVControls() {
            document.addEventListener('keydown', function(e) {
                const key = e.keyCode || e.which;
                
                // Teclas espec√≠ficas para Smart TV (aplicadas globalmente)
                switch(key) {
                    case 27: // ESC
                    case 10009: // Tizen Return
                        hidePlayer();
                        break;
                }
            });
        }
    </script>
</body>
</html>
