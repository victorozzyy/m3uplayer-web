<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U8 Player Web</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .input-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .hidden-playlist-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        input[type="url"], input[type="file"], input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .code-input {
            font-family: monospace;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #video {
            width: 100%;
            max-width: 800px;
            height: 450px;
            margin: 20px 0;
            border: 1px solid #ddd;
        }
        .playlist {
            display: flex;
            gap: 20px;
        }
        .playlist-section {
            flex: 1;
        }
        #playlist {
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
            background: #f9f9f9;
        }
        .channel {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .channel:hover {
            background-color: #e0e0e0;
        }
        .channel.active {
            background-color: #007bff;
            color: white;
        }
        .error {
            color: red;
            margin: 10px 0;
            padding: 10px;
            background-color: #ffe6e6;
            border: 1px solid #ff9999;
            border-radius: 4px;
        }
        .success {
            color: green;
            margin: 10px 0;
            padding: 10px;
            background-color: #e6ffe6;
            border: 1px solid #99ff99;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>M3U8 Player Web</h1>
        
        <!-- Seção de Playlist Oculta -->
        <div class="hidden-playlist-section">
            <h3>Acessar Playlist Oculta</h3>
            <label for="codeInput">Insira o código de acesso:</label>
            <input type="text" id="codeInput" class="code-input" placeholder="Digite o código aqui">
            <button onclick="loadHiddenPlaylist()">Carregar Playlist</button>
        </div>

        <div class="input-section">
            <label for="urlInput">Cole a URL da Playlist M3U8:</label>
            <input type="url" id="urlInput" placeholder="https://exemplo.com/playlist.m3u8">
            
            <label for="fileInput">Ou selecione um arquivo M3U/M3U8:</label>
            <input type="file" id="fileInput" accept=".m3u,.m3u8">
            
            <button onclick="loadPlaylist()">Carregar Playlist</button>
            <small style="color: #666; display: block; margin-top: 10px;">
                Dica: Se um canal não reproduzir, pressione 'R' para tentar novamente. Para streams M3U8, use Chrome ou Firefox.
            </small>
        </div>

        <div id="message"></div>

        <video id="video" controls>
            Seu navegador não suporta o elemento de vídeo.
        </video>

        <div class="playlist">
            <div class="playlist-section">
                <h3>Lista de Reprodução:</h3>
                <div id="playlist"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
    <script>
        let channels = [];
        let currentChannel = 0;
        let hls = null;

        // Dicionário de playlists ocultas (substitua com seus códigos e URLs)
        const HIDDEN_PLAYLISTS = {
            "tvmista171": "https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/tvmisto.m3u8",
            "premium456": "https://raw.githubusercontent.com/seu-usuario/seu-repo/main/playlists/premium.m3u8",
            "esportes789": "https://raw.githubusercontent.com/seu-usuario/seu-repo/main/playlists/sports.m3u8"
        };

        function showMessage(message, type = 'error') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = type;
            setTimeout(() => {
                messageDiv.textContent = '';
                messageDiv.className = '';
            }, 5000);
        }

        function loadHiddenPlaylist() {
            const code = document.getElementById('codeInput').value.trim();
            
            if (!code) {
                showMessage('Por favor, insira um código de acesso.');
                return;
            }

            if (HIDDEN_PLAYLISTS[code]) {
                document.getElementById('urlInput').value = HIDDEN_PLAYLISTS[code];
                loadPlaylist();
                showMessage('Playlist oculta carregada com sucesso!', 'success');
            } else {
                showMessage('Código inválido. Verifique e tente novamente.');
            }
        }

        function loadPlaylist() {
            const urlInput = document.getElementById('urlInput');
            const fileInput = document.getElementById('fileInput');
            
            if (urlInput.value.trim()) {
                loadFromUrl(urlInput.value.trim());
            } else if (fileInput.files.length > 0) {
                loadFromFile(fileInput.files[0]);
            } else {
                showMessage('Por favor, insira uma URL ou selecione um arquivo.');
            }
        }

        function loadFromUrl(url) {
            if (!isValidUrl(url)) {
                showMessage('URL inválida. Por favor, insira uma URL válida.');
                return;
            }

            showMessage('Carregando playlist...', 'success');
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                    return response.text();
                })
                .then(data => {
                    parseM3U(data);
                })
                .catch(error => {
                    console.error('Erro ao carregar URL:', error);
                    showMessage('Erro ao carregar a playlist. Verifique se a URL está correta e acessível.');
                });
        }

        function loadFromFile(file) {
            if (!file.name.toLowerCase().endsWith('.m3u') && !file.name.toLowerCase().endsWith('.m3u8')) {
                showMessage('Por favor, selecione um arquivo .m3u ou .m3u8');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                parseM3U(e.target.result);
            };
            reader.onerror = function() {
                showMessage('Erro ao ler o arquivo.');
            };
            reader.readAsText(file);
        }

        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }

        function parseM3U(data) {
            channels = [];
            const lines = data.split('\n');
            let currentChannel = null;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    const titleMatch = line.match(/,(.*)$/);
                    currentChannel = {
                        title: titleMatch ? titleMatch[1].trim() : 'Canal sem nome',
                        url: null
                    };
                } else if (line && !line.startsWith('#') && currentChannel) {
                    currentChannel.url = line;
                    channels.push(currentChannel);
                    currentChannel = null;
                }
            }

            if (channels.length === 0) {
                showMessage('Nenhum canal encontrado na playlist. Verifique o formato do arquivo.');
                return;
            }

            displayPlaylist();
            showMessage(`Playlist carregada com sucesso! ${channels.length} canais encontrados.`, 'success');
        }

        function displayPlaylist() {
            const playlistDiv = document.getElementById('playlist');
            playlistDiv.innerHTML = '';

            channels.forEach((channel, index) => {
                const channelDiv = document.createElement('div');
                channelDiv.className = 'channel';
                channelDiv.textContent = channel.title;
                channelDiv.onclick = () => playChannel(index);
                playlistDiv.appendChild(channelDiv);
            });
        }

        function playChannel(index) {
            if (index < 0 || index >= channels.length) {
                showMessage('Canal inválido.');
                return;
            }

            currentChannel = index;
            const video = document.getElementById('video');
            const channel = channels[index];

            // Atualizar classe ativa
            document.querySelectorAll('.channel').forEach(ch => ch.classList.remove('active'));
            document.querySelectorAll('.channel')[index].classList.add('active');

            // Limpar player anterior
            if (hls) {
                hls.destroy();
                hls = null;
            }
            video.src = '';
            video.load();

            showMessage(`Tentando reproduzir: ${channel.title}`, 'success');

            // Verificar se é HLS
            if (channel.url.includes('.m3u8') || channel.url.includes('m3u8')) {
                loadHLSStream(video, channel);
            } else {
                loadDirectStream(video, channel);
            }
        }

        function loadHLSStream(video, channel) {
            if (Hls.isSupported()) {
                hls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90
                });
                
                hls.loadSource(channel.url);
                hls.attachMedia(video);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play().catch(error => {
                        console.log('Erro ao reproduzir:', error);
                        showMessage(`Clique no vídeo para iniciar a reprodução.`);
                    });
                });

                hls.on(Hls.Events.ERROR, function(event, data) {
                    console.log('Erro HLS:', data);
                    if (data.fatal) {
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                hls.recoverMediaError();
                                break;
                            default:
                                loadDirectStream(video, channel);
                                break;
                        }
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = channel.url;
                video.addEventListener('loadedmetadata', function() {
                    video.play().catch(error => {
                        console.log('Erro reprodução:', error);
                    });
                });
            } else {
                showMessage('Seu navegador não suporta este tipo de stream.');
            }
        }

        function loadDirectStream(video, channel) {
            video.src = channel.url;
            video.load();
            video.play().catch(error => {
                console.log('Erro ao reproduzir:', error);
                showMessage('Clique no botão play para iniciar manualmente.');
            });
        }

        // Event listeners
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') loadPlaylist();
        });

        document.getElementById('codeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') loadHiddenPlaylist();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'r' || e.key === 'R') {
                if (channels.length > 0 && currentChannel >= 0) {
                    playChannel(currentChannel);
                }
            }
        });

        window.addEventListener('beforeunload', function() {
            if (hls) hls.destroy();
        });
    </script>
    <iframe name=Player "" src="//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=warner" frameborder=0 height=400 scrolling=no width=640 allow="encrypted-media" allowFullScreen> </iframe>

</body>
</html>
