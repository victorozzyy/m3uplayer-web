<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="stylesheet" href="style.css">
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player M3U8 Smart</title>
    
</head>
<body>
    <div class="container">
        <h1>üé¨ Player M3U8 - Tizen TV</h1>
        
        <div class="button-container">
            <button class="btn btn-show" id="showBtn">üì∫ Canais Fixos</button>
            <button class="btn btn-m3u8" id="m3u8Btn">üé¨ M3U8 Player</button>
            <button class="btn btn-hide" id="hideBtn" disabled>‚ùå Fechar</button>
        </div>

        <div class="channel-selection" id="channelSelection">
            <h2>üì∫ Escolha um Canal</h2>
            <div class="channel-grid" id="channelGrid"></div>
        </div>

        <div class="player-container" id="playerContainer">
            <div class="video-wrapper">
                <iframe id="playerFrame" class="tizen-video" frameborder="0" allowfullscreen></iframe>
            </div>
            <div class="controls">
                <button class="control-btn" onclick="hidePlayer()">Voltar</button>
            </div>
        </div>

        <div class="player-container" id="m3u8Container">
            <div class="input-section">
                <h3>üîê Playlist Oculta</h3>
                <div class="input-group">
                    <label for="codeInput">C√≥digo de Acesso:</label>
                    <input type="text" id="codeInput" placeholder="Digite o c√≥digo da playlist">
                </div>
                <button class="btn btn-m3u8" id="loadHiddenBtn" onclick="loadHiddenPlaylist()">Carregar Playlist</button>
            </div>

            <div class="input-section">
                <h3>üåê Carregar Playlist Manualmente</h3>
                <div class="input-group">
                    <label for="urlInput">URL da Playlist:</label>
                    <input type="url" id="urlInput" placeholder="https://exemplo.com/playlist.m3u8">
                </div>
                <button class="btn btn-m3u8" onclick="loadPlaylist()">Carregar URL</button>
            </div>

            <div class="video-wrapper">
                <video id="tizenVideo" class="tizen-video" controls playsinline webkit-playsinline></video>
            </div>

            <div class="controls">
                <button class="control-btn" onclick="previousChannel()">‚èÆ Anterior</button>
                <button class="control-btn" onclick="nextChannel()">‚è≠ Pr√≥ximo</button>
                <button class="control-btn" onclick="reloadChannel()">üîÑ Recarregar</button>
                <button class="control-btn" onclick="togglePlayPause()">‚èØ Play/Pause</button>
            </div>

            <div>
                <h3>üìã Lista de Canais (<span id="channelCount">0</span>)</h3>
                <div class="playlist-container" id="m3u8Playlist"></div>
            </div>
        </div>

        <div class="status" id="status"></div>
    </div>

    <div class="button-container" style="margin-top: 30px;">
        <button class="btn btn-external" onclick="window.open('https://nossoplayeronlinehd.blog/', '_blank')">üåê Nosso Player Online</button>
        <button class="btn btn-external" onclick="window.open('https://embedcanaistv.com/', '_blank')">üì∫ Embed Canais TV</button>
    </div>

    <script>
       
	   // Canais fixos otimizados para Tizen
        const channels = [
            { name: 'Warner', url: 'https://embedcanaistv.com/warner/', icon: 'üé¨' },
            { name: 'ESPN', url: 'https://embedcanaistv.com/espn/', icon: '‚öΩ' },
			{ name: 'ESPN2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn2', icon: '‚öΩ' },
			{ name: 'ESPN3', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn3', icon: '‚öΩ' },
			{ name: 'ESPN4', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn4', icon: '‚öΩ' },
			{ name: 'ESPN5', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn5', icon: '‚öΩ' },
			{ name: 'ESPN6', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=espn6', icon: '‚öΩ' },
			{ name: 'SportTV1', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=sportv1', icon: '‚öΩ' },
			{ name: 'SportTV2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=sportv2', icon: '‚öΩ' },
        	{ name: 'SportTV3', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=sportv3', icon: '‚öΩ' },
        	{ name: 'Premiere', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiereclubes', icon: '‚öΩ' },
        	{ name: 'Premiere2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere2', icon: '‚öΩ' },
        	{ name: 'Premiere3', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere3', icon: '‚öΩ' },
        	{ name: 'Premiere4', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere4', icon: '‚öΩ' },
        	{ name: 'Premiere5', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere5', icon: '‚öΩ' },
        	{ name: 'Premiere6', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=premiere6', icon: '‚öΩ' },
        	{ name: 'TNT', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=tnt', icon: 'üì∫' },
			{ name: 'TNTseries', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=tntseries', icon: 'üì∫' },
			{ name: 'HBO', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=hbo', icon: 'üì∫' },
			{ name: 'HBO2', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=hbo2', icon: 'üì∫' },
        	{ name: 'Universal', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=universal', icon: 'üì∫' },
			{ name: 'Space', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=space', icon: 'üì∫' },
            { name: 'Telecine Action', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=telecineaction', icon: 'üì∫' },
            { name: 'Megapix', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=megapix', icon: 'üì∫' },
			{ name: 'UFC', url: '//%72%65%64%65%63%61%6E%61%69%73%74%76%2E%67%64/player3/ch.php?canal=ufcfightpass', icon: 'üì∫' },
        ];

        // Playlists ocultas atualizadas
        const hiddenPlaylists = {
             "tvmista": [
                "https%3A%2F%2Fraw.githubusercontent.com%2Fvictorozzyy%2Fm3uplayer-web%2Frefs%2Fheads%2Fmain%2Fplaylists%2Ftvmisto.m3u8",
		"https://cors-proxy.fringe.zone/https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/tvmisto.m3u8"
                ],
                "xxxxxxx": [
                    "https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/teste.m3u8"
                    
                ],
                "xxxxxxxx": [
                    "https://raw.githubusercontent.com/victorozzyy/m3uplayer-web/refs/heads/main/playlists/educativo.m3u8"
                   
                ]
            };

        // Vari√°veis globais
        let m3u8Channels = [];
        let currentM3U8Channel = -1;
        let hls = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar bot√µes
            document.getElementById('showBtn').addEventListener('click', showChannelSelection);
            document.getElementById('m3u8Btn').addEventListener('click', showM3U8Player);
            document.getElementById('hideBtn').addEventListener('click', hidePlayer);
            
            // Configurar eventos de teclado para Smart TV
            setupTVControls();
            
            // Verificar se √© uma Tizen TV
            if (isTizenTV()) {
                showStatus('üñ•Ô∏è Modo Tizen ativado - Player otimizado', 'visible');
            }
        });

        // Fun√ß√µes principais
        function showChannelSelection() {
            hideAllPlayers();
            document.getElementById('channelSelection').classList.add('show');
            updateButtons('channel');
            showStatus('üì∫ Selecione um canal para assistir', 'visible');
            createChannelButtons();
        }

        function showM3U8Player() {
            hideAllPlayers();
            document.getElementById('m3u8Container').classList.add('show');
            updateButtons('m3u8');
            showStatus('üé¨ Carregue uma playlist M3U8', 'visible');
        }

        function hidePlayer() {
            hideAllPlayers();
            if (hls) {
                hls.destroy();
                hls = null;
            }
            updateButtons('none');
            showStatus('üî¥ Selecione uma op√ß√£o para come√ßar', 'visible');
        }

        function hideAllPlayers() {
            document.getElementById('channelSelection').classList.remove('show');
            document.getElementById('playerContainer').classList.remove('show');
            document.getElementById('m3u8Container').classList.remove('show');
            
            // Limpar players
            document.getElementById('playerFrame').src = '';
            const video = document.getElementById('tizenVideo');
            video.src = '';
            video.load();
        }

        function updateButtons(active) {
            document.getElementById('showBtn').disabled = active === 'channel';
            document.getElementById('m3u8Btn').disabled = active === 'm3u8';
            document.getElementById('hideBtn').disabled = active === 'none';
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Canais Fixos
        function createChannelButtons() {
            const grid = document.getElementById('channelGrid');
            grid.innerHTML = '';
            
            channels.forEach((channel, index) => {
                const btn = document.createElement('button');
                btn.className = 'channel-btn';
                btn.innerHTML = `${channel.icon} ${channel.name}`;
                btn.onclick = () => playFixedChannel(channel, index);
                grid.appendChild(btn);
            });
        }

        function playFixedChannel(channel, index) {
            // Limpar sele√ß√£o anterior
            document.querySelectorAll('.channel-btn').forEach(btn => btn.classList.remove('active'));
            
            // Marcar como ativo
            document.querySelectorAll('.channel-btn')[index].classList.add('active');
            
            // Configurar iframe
            const iframe = document.getElementById('playerFrame');
            iframe.src = channel.url;
            
            // Mostrar player
            document.getElementById('playerContainer').classList.add('show');
            showStatus(`‚ñ∂Ô∏è Assistindo: ${channel.name}`, 'visible');
        }

        // Player M3U8
        function loadHiddenPlaylist() {
            const code = document.getElementById('codeInput').value.trim();
            const btn = document.getElementById('loadHiddenBtn');
            
            if (!code) {
                showStatus('‚ùå Digite um c√≥digo de acesso', 'error');
                return;
            }
            
            if (!hiddenPlaylists[code]) {
                showStatus('‚ùå C√≥digo inv√°lido. Tente: tvmista ou teste', 'error');
                return;
            }
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Carregando...';
            
            // Tentar todas as URLs da playlist at√© uma funcionar
            let loaded = false;
            const promises = hiddenPlaylists[code].map(url => loadPlaylistFromUrl(url));
            
            Promise.any(promises)
                .then(() => {
                    btn.disabled = false;
                    btn.textContent = 'Carregar Playlist';
                })
                .catch(() => {
                    // This catch block means ALL provided URLs (including proxies) failed to load the M3U8 manifest.
                    // The issue "n√£o est√£o reproduzindo" could also mean the manifest loads, but segments fail.
                    // However, within the 'playlists ocultas' section, this is the limit of handling.
                    showStatus('‚ùå N√£o foi poss√≠vel carregar a playlist. Verifique o c√≥digo ou a disponibilidade da playlist.', 'error');
                    btn.disabled = false;
                    btn.textContent = 'Carregar Playlist';
                });
        }

        function loadPlaylist() {
            const url = document.getElementById('urlInput').value.trim();
            
            if (!url) {
                showStatus('‚ùå Digite uma URL v√°lida', 'error');
                return;
            }
            
            loadPlaylistFromUrl(url);
        }

        function loadPlaylistFromUrl(url) {
            showStatus('üîÑ Carregando playlist...', 'visible');
            
            return fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('Erro na requisi√ß√£o');
                    return response.text();
                })
                .then(data => {
                    parseM3U(data);
                    showStatus(`‚úÖ Playlist carregada - ${m3u8Channels.length} canais`, 'visible');
                    return true;
                })
                .catch(error => {
                    showStatus(`‚ùå Erro ao carregar: ${error.message}. Tente usar um proxy de CORS ou verificar a URL.`, 'error');
                    throw error;
                });
        }

        function parseM3U(data) {
            m3u8Channels = [];
            const lines = data.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    const title = line.split(',')[1] || `Canal ${m3u8Channels.length + 1}`;
                    const nextLine = lines[i + 1] ? lines[i + 1].trim() : '';
                    
                    if (nextLine && !nextLine.startsWith('#') && (nextLine.startsWith('http') || nextLine.startsWith('//'))) {
                        m3u8Channels.push({
                            title: title,
                            url: nextLine
                        });
                    }
                }
            }
            
            updatePlaylistDisplay();
        }

        function updatePlaylistDisplay() {
            const playlist = document.getElementById('m3u8Playlist');
            playlist.innerHTML = '';
            
            m3u8Channels.forEach((channel, index) => {
                const item = document.createElement('div');
                item.className = 'm3u8-channel';
                item.textContent = `${index + 1}. ${channel.title}`;
                item.onclick = () => playM3U8Channel(index);
                playlist.appendChild(item);
            });
            
            document.getElementById('channelCount').textContent = m3u8Channels.length;
            
            // Reproduzir o primeiro canal se existir
            if (m3u8Channels.length > 0) {
                playM3U8Channel(0);
            }
        }

        // Reprodu√ß√£o otimizada para Tizen
        function playM3U8Channel(index) {
            if (index < 0 || index >= m3u8Channels.length) return;
            
            currentM3U8Channel = index;
            const channel = m3u8Channels[index];
            const video = document.getElementById('tizenVideo');
            
            // Atualizar sele√ß√£o
            document.querySelectorAll('.m3u8-channel').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.m3u8-channel')[index].classList.add('active');
            
            showStatus(`üîÑ Carregando: ${channel.title}`, 'visible');
            
            // Limpar player anterior
            if (hls) {
                hls.destroy();
                hls = null;
            }
            
            video.src = '';
            video.load();
            
            // Configura√ß√µes espec√≠ficas para Tizen
            video.crossOrigin = 'anonymous';
            video.preload = 'auto';
            video.playsInline = true;
            
            // Verificar se √© HLS
            if (channel.url.includes('.m3u8')) {
                if (isTizenTV()) {
                    // Tizen tem suporte nativo excelente para HLS
                    playNativeHLS(video, channel);
                } else if (typeof Hls !== 'undefined' && Hls.isSupported()) {
                    // Usar Hls.js para outros navegadores
                    playWithHlsJS(video, channel);
                } else {
                    // Fallback para reprodu√ß√£o nativa
                    playNativeHLS(video, channel);
                }
            } else {
                // Reprodu√ß√£o direta para outros formatos
                playDirectStream(video, channel);
            }
        }

        function playNativeHLS(video, channel) {
            console.log('üîß Usando HLS nativo no Tizen');
            
            video.src = channel.url;
            
            video.addEventListener('loadedmetadata', function() {
                video.play()
                    .then(() => showStatus(`‚ñ∂Ô∏è Assistindo: ${channel.title}`, 'visible'))
                    .catch(error => {
                        console.error('Erro ao reproduzir:', error);
                        showStatus('‚ñ∂Ô∏è Canal carregado. Pressione Play.', 'visible');
                    });
            });
            
            video.addEventListener('error', function() {
                showStatus('‚ùå Erro ao carregar o v√≠deo', 'error');
            });
        }

        function playWithHlsJS(video, channel) {
            console.log('üîß Usando Hls.js para reprodu√ß√£o');
            
            hls = new Hls({
                enableWorker: false,
                lowLatencyMode: false,
                backBufferLength: 30
            });
            
            hls.loadSource(channel.url);
            hls.attachMedia(video);
            
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play()
                    .then(() => showStatus(`‚ñ∂Ô∏è Assistindo: ${channel.title}`, 'visible'))
                    .catch(error => {
                        console.error('Erro ao reproduzir:', error);
                        showStatus('‚ñ∂Ô∏è Canal carregado. Pressione Play.', 'visible');
                    });
            });
            
            hls.on(Hls.Events.ERROR, function(event, data) {
                if (data.fatal) {
                    showStatus('‚ùå Erro fatal no player. Tente outro canal.', 'error');
                    hls.destroy();
                }
            });
        }

        function playDirectStream(video, channel) {
            console.log('üîß Reprodu√ß√£o direta do stream');
            
            video.src = channel.url;
            
            video.addEventListener('loadeddata', function() {
                video.play()
                    .then(() => showStatus(`‚ñ∂Ô∏è Assistindo: ${channel.title}`, 'visible'))
                    .catch(error => {
                        console.error('Erro ao reproduzir:', error);
                        showStatus('‚ñ∂Ô∏è Canal carregado. Pressione Play.', 'visible');
                    });
            });
            
            video.addEventListener('error', function() {
                showStatus('‚ùå Erro ao carregar o v√≠deo', 'error');
            });
        }

        // Controles
        function previousChannel() {
            if (m3u8Channels.length === 0) return;
            const prevIndex = (currentM3U8Channel - 1 + m3u8Channels.length) % m3u8Channels.length;
            playM3U8Channel(prevIndex);
        }

        function nextChannel() {
            if (m3u8Channels.length === 0) return;
            const nextIndex = (currentM3U8Channel + 1) % m3u8Channels.length;
            playM3U8Channel(nextIndex);
        }

        function reloadChannel() {
            if (currentM3U8Channel >= 0) {
                playM3U8Channel(currentM3U8Channel);
            }
        }

        function togglePlayPause() {
            const video = document.getElementById('tizenVideo');
            if (video.paused) {
                video.play().catch(e => console.error(e));
            } else {
                video.pause();
            }
        }

        // Utilit√°rios
        function isTizenTV() {
            return navigator.userAgent.includes('Tizen') || 
                   navigator.userAgent.includes('SMART-TV') ||
                   typeof tizen !== 'undefined';
        }

        function setupTVControls() {
            document.addEventListener('keydown', function(e) {
                const key = e.keyCode || e.which;
                
                // Teclas espec√≠ficas para Smart TV
                switch(key) {
                    case 37: // Left
                    case 4:   // Tizen Left
                        previousChannel();
                        break;
                    case 39: // Right
                    case 5:   // Tizen Right
                        nextChannel();
                        break;
                    case 13: // Enter
                    case 32: // Space
                        togglePlayPause();
                        break;
                    case 27: // ESC
                    case 10009: // Tizen Return
                        hidePlayer();
                        break;
                }
            });
        }
		
		

    </script>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
	
</body>
</html>
